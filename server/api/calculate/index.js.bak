

const route  = {
  calculator: (app) =>{
    app.post('/api/calculate', async (req, reply) => {

      const lib = require('./lib/arrayReducer');
      // we make calculations here

      const expressionRaw = req.body;
      console.log(expressionRaw.expression);

      let expressionNumbersArray = expressionRaw.expression.split(/\D/gi);
      const operatorsStringTemp = expressionRaw.expression.replace(/\d/gi, '');
      let operatorsArray = operatorsStringTemp.split('');

      const numericValues = expressionNumbersArray.map( num => Number(num));
      console.log(numericValues);


      ['x', '/', '-', '+'].forEach(opType=>{
        for( let op = operatorsArray.length -1 ; op >= 0;  op--){

            // Start

            if(operatorsArray[op] === opType)  {
              console.log(opType + ' ==> ' + operatorsArray[op]);
              console.log(`Start ${op}`, expressionNumbersArray, operatorsArray, op);
              expressionNumbersArray = lib.arrayReduce(expressionNumbersArray, opType, op);
              operatorsArray.splice(op, 1)
              console.log(`End ${op}`, expressionNumbersArray, operatorsArray, op);
              console.log('-------------------------------------------------------');
            }
        };

      });



      return {
        expression: req.body,
        result: expressionNumbersArray[0]
      };

    });
  }
}

module.exports = route
